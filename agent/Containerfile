#FROM registry.access.redhat.com/ubi9/python-311:latest
FROM image-registry.openshift-image-registry.svc:5000/openshift/python:3.11-ubi9

WORKDIR /app

COPY --chown=1001:0 requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY --chown=1001:0 main.py .
COPY --chown=1001:0 mcp_client.py .
COPY --chown=1001:0 pytest.ini .
COPY --chown=1001:0 tests/ tests/

# Run tests during build to verify application works
RUN pytest tests/ -v --tb=short

EXPOSE 8000

CMD ["python", "main.py"]
